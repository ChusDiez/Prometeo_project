(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{6067:(e,a,s)=>{Promise.resolve().then(s.bind(s,388))},388:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>x});var r=s(5155),t=s(2115),l=s(3391),n=s(8943);let d=(0,n.zD)("admin/updateExam",async e=>{let{examId:a,payload:s}=e;return{message:"Examen actualizado con \xe9xito"}}),i=(0,n.zD)("admin/fetchUsersScores",async()=>[{user_id:1,exam_id:123,final_score:8.5,users:{},exams:{}}]),o=(0,n.zD)("admin/fetchExamsStats",async()=>[{exam_id:"ABC",p80:9,p70:8,p60:7,media:7.5}]),c=(0,n.Z0)({name:"admin",initialState:{updatingExam:!1,updateError:null,updateMessage:null,usersScores:[],loadingScores:!1,scoresError:null,examsStats:[],loadingStats:!1,statsError:null},reducers:{clearAdminMessages(e){e.updateError=null,e.updateMessage=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.updatingExam=!0,e.updateError=null,e.updateMessage=null}),e.addCase(d.fulfilled,(e,a)=>{e.updatingExam=!1,e.updateMessage=a.payload.message}),e.addCase(d.rejected,(e,a)=>{e.updatingExam=!1,e.updateError=a.error.message||"Error al actualizar examen"}),e.addCase(i.pending,e=>{e.loadingScores=!0,e.scoresError=null}),e.addCase(i.fulfilled,(e,a)=>{e.loadingScores=!1,e.usersScores=a.payload}),e.addCase(i.rejected,(e,a)=>{e.loadingScores=!1,e.scoresError=a.error.message||"Error al cargar userScores"}),e.addCase(o.pending,e=>{e.loadingStats=!0,e.statsError=null}),e.addCase(o.fulfilled,(e,a)=>{e.loadingStats=!1,e.examsStats=a.payload}),e.addCase(o.rejected,(e,a)=>{e.loadingStats=!1,e.statsError=a.error.message||"Error al obtener stats"})}}),{clearAdminMessages:h}=c.actions;c.reducer;var u=s(2818);function x(){let e=(0,l.wA)(),{updatingExam:a,updateError:s,updateMessage:n,usersScores:c,loadingScores:x,scoresError:j,examsStats:m,loadingStats:g,statsError:y}=(0,l.d4)(e=>e.admin),[f,E]=(0,t.useState)(null),[v,S]=(0,t.useState)(""),[b,C]=(0,t.useState)(""),[_,D]=(0,t.useState)(""),[w,I]=(0,t.useState)(""),[G,U]=(0,t.useState)(""),[A,N]=(0,t.useState)(""),[k,z]=(0,t.useState)([]),[B,L]=(0,t.useState)(!1),[M,P]=(0,t.useState)(null),[R,V]=(0,t.useState)("");async function F(){if(S(""),C(""),!f){S("Selecciona un archivo CSV primero");return}try{let e=u.env.NEXT_PUBLIC_API_BASE_URL||"https://prometeoproject-production.up.railway.app",a=new FormData;a.append("csvFile",f),a.append("start_date",w),a.append("end_date",G),a.append("zoom_url",A),a.append("examId",_);let s=await fetch("".concat(e,"/api/exams/upload-csv"),{method:"POST",body:a});if(!s.ok){let e=await s.json();throw Error(e.error||"Error al subir CSV")}let r=await s.json();C("CSV subido OK. examId: ".concat(r.examId||""))}catch(e){console.error(e),S(e.message)}}async function O(){L(!0),P(null);try{let e=u.env.NEXT_PUBLIC_API_BASE_URL||"https://prometeoproject-production.up.railway.app",a=await fetch("".concat(e,"/api/admin/users"));if(!a.ok){let e=await a.json();throw Error(e.error||"Error al obtener la lista de usuarios")}let s=await a.json();z(s.users||[])}catch(e){console.error(e),P(e.message)}finally{L(!1)}}(0,t.useEffect)(()=>{e(i())},[e]),(0,t.useEffect)(()=>{e(o())},[e]),(0,t.useEffect)(()=>{O()},[]),(0,t.useEffect)(()=>()=>{e(h())},[e]);let T=m.filter(e=>""===R||e.exam_id.includes(R));return(0,r.jsxs)("div",{style:p.container,children:[(0,r.jsx)("h1",{children:"Admin Dashboard"}),(0,r.jsxs)("section",{style:p.section,children:[(0,r.jsx)("h2",{children:"Subir CSV + Examen Data"}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Archivo CSV:"}),(0,r.jsx)("input",{type:"file",accept:".csv",onChange:function(e){E(e.target.files[0])}})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Exam ID (opcional):"}),(0,r.jsx)("input",{type:"text",value:_,onChange:e=>D(e.target.value)})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Start Date:"}),(0,r.jsx)("input",{type:"datetime-local",value:w,onChange:e=>I(e.target.value)})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"End Date:"}),(0,r.jsx)("input",{type:"datetime-local",value:G,onChange:e=>U(e.target.value)})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Zoom URL:"}),(0,r.jsx)("input",{type:"text",value:A,onChange:e=>N(e.target.value)})]}),(0,r.jsx)("button",{onClick:F,children:"Subir CSV / Crear-Actualizar"}),v&&(0,r.jsx)("p",{style:{color:"red"},children:v}),b&&(0,r.jsx)("p",{style:{color:"green"},children:b})]}),(0,r.jsxs)("section",{style:p.section,children:[(0,r.jsx)("h2",{children:"Editar Examen"}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Exam ID:"}),(0,r.jsx)("input",{type:"text",value:_,onChange:e=>D(e.target.value)})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Start Date:"}),(0,r.jsx)("input",{type:"datetime-local",value:w,onChange:e=>I(e.target.value)})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"End Date:"}),(0,r.jsx)("input",{type:"datetime-local",value:G,onChange:e=>U(e.target.value)})]}),(0,r.jsxs)("div",{style:p.formGroup,children:[(0,r.jsx)("label",{children:"Zoom URL:"}),(0,r.jsx)("input",{type:"text",value:A,onChange:e=>N(e.target.value)})]}),(0,r.jsx)("button",{onClick:function(){if(!_){alert("Especifica el ID del examen");return}e(d({examId:_,payload:{start_date:w,end_date:G,zoom_url:A}}))},disabled:a,children:a?"Guardando...":"Guardar Cambios"}),s&&(0,r.jsx)("p",{style:{color:"red"},children:s}),n&&(0,r.jsx)("p",{style:{color:"green"},children:n})]}),(0,r.jsxs)("section",{style:p.section,children:[(0,r.jsx)("h2",{children:"Usuarios y Notas (userScores)"}),x&&(0,r.jsx)("p",{children:"Cargando users-scores..."}),j&&(0,r.jsx)("p",{style:{color:"red"},children:j}),!x&&!j&&c.length>0&&(0,r.jsxs)("table",{style:p.table,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"User ID"}),(0,r.jsx)("th",{children:"Exam ID"}),(0,r.jsx)("th",{children:"Final Score"}),(0,r.jsx)("th",{children:"Usuario / Examen"})]})}),(0,r.jsx)("tbody",{children:c.map((e,a)=>{var s,t;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.user_id}),(0,r.jsx)("td",{children:e.exam_id}),(0,r.jsx)("td",{children:e.final_score}),(0,r.jsxs)("td",{children:[null===(s=e.users)||void 0===s?void 0:s.email," / ",null===(t=e.exams)||void 0===t?void 0:t.title]})]},a)})})]})]}),(0,r.jsxs)("section",{style:p.section,children:[(0,r.jsx)("h2",{children:"Lista de Usuarios (fetch /api/admin/users)"}),B&&(0,r.jsx)("p",{children:"Cargando usuarios..."}),M&&(0,r.jsx)("p",{style:{color:"red"},children:M}),!B&&!M&&k.length>0&&(0,r.jsxs)("table",{style:p.table,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ID"}),(0,r.jsx)("th",{children:"Nombre"}),(0,r.jsx)("th",{children:"Email"}),(0,r.jsx)("th",{children:"Nota (ej)"})]})}),(0,r.jsx)("tbody",{children:k.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.id}),(0,r.jsx)("td",{children:e.name}),(0,r.jsx)("td",{children:e.email}),(0,r.jsx)("td",{children:e.nota})]},e.id))})]})]}),(0,r.jsxs)("section",{style:p.section,children:[(0,r.jsx)("h2",{children:"Estad\xedsticas de Ex\xe1menes (p80, p70, p60, media)"}),(0,r.jsx)("label",{children:"Filtrar exam_id: "}),(0,r.jsx)("input",{type:"text",value:R,onChange:e=>V(e.target.value),style:{marginBottom:"10px"}}),g&&(0,r.jsx)("p",{children:"Cargando estad\xedsticas..."}),y&&(0,r.jsx)("p",{style:{color:"red"},children:y}),!g&&!y&&T.length>0&&(0,r.jsxs)("table",{style:p.table,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Exam ID"}),(0,r.jsx)("th",{children:"p80"}),(0,r.jsx)("th",{children:"p70"}),(0,r.jsx)("th",{children:"p60"}),(0,r.jsx)("th",{children:"Media"})]})}),(0,r.jsx)("tbody",{children:T.map((e,a)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.exam_id}),(0,r.jsx)("td",{children:e.p80}),(0,r.jsx)("td",{children:e.p70}),(0,r.jsx)("td",{children:e.p60}),(0,r.jsx)("td",{children:e.media})]},a))})]}),!g&&!y&&0===T.length&&(0,r.jsx)("p",{children:"No hay datos de estad\xedstica para ese examen."})]})]})}let p={container:{maxWidth:"800px",margin:"0 auto",padding:"20px",fontFamily:"sans-serif"},section:{marginBottom:"30px",border:"1px solid #ccc",padding:"15px",borderRadius:"6px"},formGroup:{marginBottom:"10px"},table:{width:"100%",borderCollapse:"collapse"}}}},e=>{var a=a=>e(e.s=a);e.O(0,[391,943,441,517,358],()=>a(6067)),_N_E=e.O()}]);