(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{9051:(e,a,s)=>{Promise.resolve().then(s.bind(s,388))},388:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>u});var t=s(5155),r=s(2115),l=s(3391),d=s(9442);let n=(0,d.zD)("admin/updateExam",async e=>{let{examId:a,payload:s}=e;return{message:"Examen actualizado con \xe9xito"}}),i=(0,d.zD)("admin/fetchUsersScores",async()=>[{user_id:1,exam_id:123,final_score:8.5,users:{id:1,email:"test@example.com"},exams:{id:123,title:"Examen A"}}]),o=(0,d.zD)("admin/fetchExamsStats",async()=>[{exam_id:"ABC",p80:9,p70:8,p60:7,media:7.5}]),c=(0,d.Z0)({name:"admin",initialState:{updatingExam:!1,updateError:null,updateMessage:null,usersScores:[],loadingScores:!1,scoresError:null,examsStats:[],loadingStats:!1,statsError:null},reducers:{clearAdminMessages(e){e.updateError=null,e.updateMessage=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.updatingExam=!0,e.updateError=null,e.updateMessage=null}).addCase(n.fulfilled,(e,a)=>{e.updatingExam=!1,e.updateMessage=a.payload.message}).addCase(n.rejected,(e,a)=>{e.updatingExam=!1,e.updateError=a.error.message||"Error al actualizar examen"}),e.addCase(i.pending,e=>{e.loadingScores=!0,e.scoresError=null}).addCase(i.fulfilled,(e,a)=>{e.loadingScores=!1,e.usersScores=a.payload}).addCase(i.rejected,(e,a)=>{e.loadingScores=!1,e.scoresError=a.error.message||"Error al cargar userScores"}),e.addCase(o.pending,e=>{e.loadingStats=!0,e.statsError=null}).addCase(o.fulfilled,(e,a)=>{e.loadingStats=!1,e.examsStats=a.payload}).addCase(o.rejected,(e,a)=>{e.loadingStats=!1,e.statsError=a.error.message||"Error al obtener estad\xedsticas"})}}),{clearAdminMessages:x}=c.actions;c.reducer;var h=s(2818);function u(){let e=(0,l.wA)(),{updatingExam:a,updateError:s,updateMessage:d,usersScores:c,loadingScores:u,scoresError:j,examsStats:m,loadingStats:g,statsError:y}=(0,l.d4)(e=>e.admin),[f,E]=(0,r.useState)(null),[v,S]=(0,r.useState)(""),[b,C]=(0,r.useState)(""),[_,D]=(0,r.useState)(""),[w,I]=(0,r.useState)(""),[G,A]=(0,r.useState)(""),[U,N]=(0,r.useState)(""),[k,z]=(0,r.useState)([]),[B,L]=(0,r.useState)(!1),[M,P]=(0,r.useState)(null),[R,V]=(0,r.useState)("");async function F(){if(S(""),C(""),!f){S("Selecciona un archivo CSV primero");return}try{let e=h.env.NEXT_PUBLIC_API_BASE_URL||"https://prometeoproject-production.up.railway.app",a=new FormData;a.append("csvFile",f),a.append("start_date",w),a.append("end_date",G),a.append("zoom_url",U),a.append("examId",_);let s=await fetch("".concat(e,"/api/exams/upload-csv"),{method:"POST",body:a});if(!s.ok){let e=await s.json();throw Error(e.error||"Error al subir CSV")}let t=await s.json();C("CSV subido OK. examId: ".concat(t.examId||""))}catch(e){console.error(e),S(e.message)}}async function O(){L(!0),P(null);try{let e=h.env.NEXT_PUBLIC_API_BASE_URL||"https://prometeoproject-production.up.railway.app",a=await fetch("".concat(e,"/api/admin/users"));if(!a.ok){let e=await a.json();throw Error(e.error||"Error al obtener la lista de usuarios")}let s=await a.json();z(s.users||[])}catch(e){console.error(e),P(e.message)}finally{L(!1)}}(0,r.useEffect)(()=>{e(i())},[e]),(0,r.useEffect)(()=>{e(o())},[e]),(0,r.useEffect)(()=>{O()},[]),(0,r.useEffect)(()=>()=>{e(x())},[e]);let T=m.filter(e=>""===R||e.exam_id.includes(R));return(0,t.jsxs)("div",{style:p.container,children:[(0,t.jsx)("h1",{children:"Admin Dashboard"}),(0,t.jsxs)("section",{style:p.section,children:[(0,t.jsx)("h2",{children:"Subir CSV + Examen Data"}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Archivo CSV:"}),(0,t.jsx)("input",{type:"file",accept:".csv",onChange:function(e){E(e.target.files[0])}})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Exam ID (opcional):"}),(0,t.jsx)("input",{type:"text",value:_,onChange:e=>D(e.target.value)})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Start Date:"}),(0,t.jsx)("input",{type:"datetime-local",value:w,onChange:e=>I(e.target.value)})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"End Date:"}),(0,t.jsx)("input",{type:"datetime-local",value:G,onChange:e=>A(e.target.value)})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Zoom URL:"}),(0,t.jsx)("input",{type:"text",value:U,onChange:e=>N(e.target.value)})]}),(0,t.jsx)("button",{onClick:F,children:"Subir CSV / Crear-Actualizar"}),v&&(0,t.jsx)("p",{style:{color:"red"},children:v}),b&&(0,t.jsx)("p",{style:{color:"green"},children:b})]}),(0,t.jsxs)("section",{style:p.section,children:[(0,t.jsx)("h2",{children:"Editar Examen"}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Exam ID:"}),(0,t.jsx)("input",{type:"text",value:_,onChange:e=>D(e.target.value)})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Start Date:"}),(0,t.jsx)("input",{type:"datetime-local",value:w,onChange:e=>I(e.target.value)})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"End Date:"}),(0,t.jsx)("input",{type:"datetime-local",value:G,onChange:e=>A(e.target.value)})]}),(0,t.jsxs)("div",{style:p.formGroup,children:[(0,t.jsx)("label",{children:"Zoom URL:"}),(0,t.jsx)("input",{type:"text",value:U,onChange:e=>N(e.target.value)})]}),(0,t.jsx)("button",{onClick:function(){if(!_){alert("Especifica el ID del examen");return}e(n({examId:_,payload:{start_date:w,end_date:G,zoom_url:U}}))},disabled:a,children:a?"Guardando...":"Guardar Cambios"}),s&&(0,t.jsx)("p",{style:{color:"red"},children:s}),d&&(0,t.jsx)("p",{style:{color:"green"},children:d})]}),(0,t.jsxs)("section",{style:p.section,children:[(0,t.jsx)("h2",{children:"Usuarios y Notas (userScores)"}),u&&(0,t.jsx)("p",{children:"Cargando users-scores..."}),j&&(0,t.jsx)("p",{style:{color:"red"},children:j}),!u&&!j&&c.length>0&&(0,t.jsxs)("table",{style:p.table,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"User ID"}),(0,t.jsx)("th",{children:"Exam ID"}),(0,t.jsx)("th",{children:"Final Score"}),(0,t.jsx)("th",{children:"Usuario / Examen"})]})}),(0,t.jsx)("tbody",{children:c.map((e,a)=>{var s,r;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.user_id}),(0,t.jsx)("td",{children:e.exam_id}),(0,t.jsx)("td",{children:e.final_score}),(0,t.jsxs)("td",{children:[null===(s=e.users)||void 0===s?void 0:s.email," / ",null===(r=e.exams)||void 0===r?void 0:r.title]})]},a)})})]})]}),(0,t.jsxs)("section",{style:p.section,children:[(0,t.jsx)("h2",{children:"Lista de Usuarios (fetch /api/admin/users)"}),B&&(0,t.jsx)("p",{children:"Cargando usuarios..."}),M&&(0,t.jsx)("p",{style:{color:"red"},children:M}),!B&&!M&&k.length>0&&(0,t.jsxs)("table",{style:p.table,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Nombre"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Nota (ej)"})]})}),(0,t.jsx)("tbody",{children:k.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.id}),(0,t.jsx)("td",{children:e.name}),(0,t.jsx)("td",{children:e.email}),(0,t.jsx)("td",{children:e.nota})]},e.id))})]})]}),(0,t.jsxs)("section",{style:p.section,children:[(0,t.jsx)("h2",{children:"Estad\xedsticas de Ex\xe1menes (p80, p70, p60, media)"}),(0,t.jsx)("label",{children:"Filtrar exam_id: "}),(0,t.jsx)("input",{type:"text",value:R,onChange:e=>V(e.target.value),style:{marginBottom:"10px"}}),g&&(0,t.jsx)("p",{children:"Cargando estad\xedsticas..."}),y&&(0,t.jsx)("p",{style:{color:"red"},children:y}),!g&&!y&&T.length>0&&(0,t.jsxs)("table",{style:p.table,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Exam ID"}),(0,t.jsx)("th",{children:"p80"}),(0,t.jsx)("th",{children:"p70"}),(0,t.jsx)("th",{children:"p60"}),(0,t.jsx)("th",{children:"Media"})]})}),(0,t.jsx)("tbody",{children:T.map((e,a)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.exam_id}),(0,t.jsx)("td",{children:e.p80}),(0,t.jsx)("td",{children:e.p70}),(0,t.jsx)("td",{children:e.p60}),(0,t.jsx)("td",{children:e.media})]},a))})]}),!g&&!y&&0===T.length&&(0,t.jsx)("p",{children:"No hay datos de estad\xedstica para ese examen."})]})]})}let p={container:{maxWidth:"800px",margin:"0 auto",padding:"20px",fontFamily:"sans-serif"},section:{marginBottom:"30px",border:"1px solid #ccc",padding:"15px",borderRadius:"6px"},formGroup:{marginBottom:"10px"},table:{width:"100%",borderCollapse:"collapse"}}}},e=>{var a=a=>e(e.s=a);e.O(0,[391,442,441,517,358],()=>a(9051)),_N_E=e.O()}]);